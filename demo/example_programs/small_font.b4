def render_char(u16 char_code, u16 x, u16 y, bool dont_render_spaces = true)
  const u16 SYS_ERROR_GLYPH2 = 130

  if char_code < 32
    char_code = SYS_ERROR_GLYPH2
  else if char_code == 32
    if dont_render_spaces
      return
  else if char_code > 129
    char_code = SYS_ERROR_GLYPH2

  char_code -= 32

  let u16 char_pointer = #~glyphs#
  let u16 char_offset = char_code << 2
  char_offset += char_code
  char_offset += char_code
  char_pointer += char_offset

  let u16 vram_pointer = 6152
  let u16 vram_offset_x = x >> 2

  // replace with 2 shifts?
  let u16 vram_offset_y = 48 * y
  vram_pointer += vram_offset_y
  vram_pointer += vram_offset_x

  let u16 pos = x & 3

  const array masks = (u16)[0xf000, 0x0f00, 0x00f0, 0x000f]
  let u16 mask = masks[pos]
  let u16 inv_mask = !mask

  let u16 scratch
  let u16 scratch2

  repeat 6
    {copy $char_pointer alu.1}
    {copy &mask alu.2}
    {copy alu.& &scratch}
    {copy $vram_pointer alu.1}
    {copy &inv_mask alu.2}
    {copy alu.& &scratch2}
    {copy &scratch alu.1}
    {copy &scratch2 alu.2}
    {copy alu.| $vram_pointer}
    char_pointer++
    vram_pointer += 8

def print_string(str string, u16 x = 0, u16 y = 0)
  let u16 pointer = #$string#
  let u16 char = *pointer

  while char > 0
    render_char(char,x,y)
    x++
    if x > 31
      y++
      x = 0
    pointer++
    char = *pointer

def type_test()
  let u16 x = 0
  let u16 y = 0
  let bool draw_cursor = true
  render_char(127,x,y)

  while true
    let u16 code = sys.kbd.get_charcode()

    if code == 0
      if draw_cursor
        render_char(127,x,y)
        draw_cursor = false
    else
      draw_cursor = true

      if code == 10
        if y < 31
          render_char(32,x,y,false)
          x = 0
          y++
      else if code == 8
        let u16 temp = x + y
        if temp > 0
          render_char(32,x,y,false)
          if x > 0
            x--
          else
            x = 31
            y--
      else if code == 127
        pass
      else
        render_char(code,x,y,false)
        x++
        if x > 31
          x = 0
          y++


// type_test()

print_string("abcdefghijklmnopqrstuvwxyz", 0, 0)
print_string("ABCDEFGHIJKLMNOPQRSTUVWXYZ", 0, 1)

// print_string("the quick brown fox jumps over the lazy dog", 0, 3)
// print_string("THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG", 0, 5)

sys.print_string("abcdefghijklmnopqrstuvwxyz", 0, 7)
sys.print_string("ABCDEFGHIJKLMNOPQRSTUVWXYZ", 0, 10)


### glyphs:
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000

0b0100000001000000
0b0100000001000000
0b0100000001000000
0b0100000001000000
0b0000000000000000
0b0100000001000000

0b0101000001010000
0b0101000001010000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0010100000101000
0b0111110001111100
0b0010100000101000
0b0111110001111100
0b0010100000101000
0b0000000000000000
0b0001000000010000
0b0011110000111100
0b0101000001010000
0b0011100000111000
0b0001010000010100
0b0111100001111000
0b0110001001100010
0b0110010001100100
0b0000100000001000
0b0001000000010000
0b0010011000100110
0b0100011001000110
0b0011000000110000
0b0100100001001000
0b0011000000110000
0b0101100001011000
0b0100100001001000
0b0011010000110100
0b0100000001000000
0b0100000001000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0001000000010000
0b0010000000100000
0b0100000001000000
0b0100000001000000
0b0010000000100000
0b0001000000010000
0b0001000000010000
0b0000100000001000
0b0000010000000100
0b0000010000000100
0b0000100000001000
0b0001000000010000
0b0101010001010100
0b0011100000111000
0b0110110001101100
0b0011100000111000
0b0101010001010100
0b0000000000000000
0b0001000000010000
0b0001000000010000
0b0111110001111100
0b0001000000010000
0b0001000000010000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0110000001100000
0b0010000000100000
0b0100000001000000
0b0000000000000000
0b0000000000000000
0b0111110001111100
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0100000001000000
0b0001000000010000
0b0001000000010000
0b0010000000100000
0b0010000000100000
0b0100000001000000
0b0100000001000000
0b0011100000111000
0b0100010001000100
0b0100110001001100
0b0101010001010100
0b0110010001100100
0b0011100000111000
0b0000100000001000
0b0001100000011000
0b0000100000001000
0b0000100000001000
0b0000100000001000
0b0001110000011100
0b0011100000111000
0b0000010000000100
0b0000010000000100
0b0001100000011000
0b0010000000100000
0b0011110000111100
0b0011100000111000
0b0000010000000100
0b0001100000011000
0b0000010000000100
0b0000010000000100
0b0011100000111000
0b0001100000011000
0b0010100000101000
0b0100100001001000
0b0011110000111100
0b0000100000001000
0b0000100000001000
0b0011110000111100
0b0010000000100000
0b0001100000011000
0b0000010000000100
0b0010010000100100
0b0001100000011000
0b0001100000011000
0b0010000000100000
0b0011100000111000
0b0010010000100100
0b0010010000100100
0b0001100000011000
0b0111100001111000
0b0000100000001000
0b0001110000011100
0b0000100000001000
0b0000100000001000
0b0000100000001000
0b0001100000011000
0b0010010000100100
0b0001100000011000
0b0010010000100100
0b0010010000100100
0b0001100000011000
0b0001100000011000
0b0010010000100100
0b0010010000100100
0b0001110000011100
0b0000010000000100
0b0001100000011000
0b0000000000000000
0b0001000000010000
0b0000000000000000
0b0000000000000000
0b0001000000010000
0b0000000000000000
0b0001000000010000
0b0001000000010000
0b0000000000000000
0b0001000000010000
0b0001000000010000
0b0010000000100000
0b0000000000000000
0b0001000000010000
0b0010000000100000
0b0100000001000000
0b0010000000100000
0b0001000000010000
0b0000000000000000
0b0111110001111100
0b0000000000000000
0b0111110001111100
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0100000001000000
0b0010000000100000
0b0001000000010000
0b0010000000100000
0b0100000001000000
0b0011100000111000
0b0100010001000100
0b0001100000011000
0b0001000000010000
0b0000000000000000
0b0001000000010000
0b0011110000111100
0b0100001001000010
0b0101101001011010
0b0101111001011110
0b0100000001000000
0b0011110000111100

0b0000000000000000
0b0010001000100010
0b0101010101010101
0b0111011101110111
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0110011001100110
0b0101010101010101
0b0110011001100110
0b0101010101010101
0b0110011001100110

0b0000000000000000
0b0011001100110011
0b0100010001000100
0b0100010001000100
0b0100010001000100
0b0011001100110011

0b0000000000000000
0b0110011001100110
0b0101010101010101
0b0101010101010101
0b0101010101010101
0b0110011001100110

0b0000000000000000
0b0111011101110111
0b0100010001000100
0b0111011101110111
0b0100010001000100
0b0111011101110111

0b0000000000000000
0b0111011101110111
0b0100010001000100
0b0110011001100110
0b0100010001000100
0b0100010001000100

0b0000000000000000
0b0011001100110011
0b0100010001000100
0b0101010101010101
0b0101010101010101
0b0010001000100010

0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0111011101110111
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0111011101110111
0b0010001000100010
0b0010001000100010
0b0010001000100010
0b0111011101110111

0b0000000000000000
0b0001000100010001
0b0001000100010001
0b0001000100010001
0b0101010101010101
0b0010001000100010

0b0000000000000000
0b0101010101010101
0b0110011001100110
0b0110011001100110
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0100010001000100
0b0100010001000100
0b0100010001000100
0b0100010001000100
0b0111011101110111

0b0000000000000000
0b0111011101110111
0b0111011101110111
0b0101010101010101
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0110011001100110
0b0101010101010101
0b0101010101010101
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0011001100110011
0b0101010101010101
0b0101010101010101
0b0101010101010101
0b0110011001100110

0b0000000000000000
0b0110011001100110
0b0101010101010101
0b0110011001100110
0b0100010001000100
0b0100010001000100

0b0000000000000000
0b0111011101110111
0b0101010101010101
0b0101010101010101
0b0110011001100110
0b0011001100110011

0b0000000000000000
0b0110011001100110
0b0101010101010101
0b0110011001100110
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0011001100110011
0b0100010001000100
0b0010001000100010
0b0001000100010001
0b0110011001100110

0b0000000000000000
0b0111011101110111
0b0010001000100010
0b0010001000100010
0b0010001000100010
0b0010001000100010

0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0101010101010101
0b0101010101010101
0b0011001100110011

0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0101010101010101
0b0010001000100010
0b0010001000100010

0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0101010101010101
0b0111011101110111
0b0111011101110111

0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0010001000100010
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0111011101110111
0b0001000100010001
0b0111011101110111

0b0000000000000000
0b0111011101110111
0b0001000100010001
0b0010001000100010
0b0100010001000100
0b0111011101110111


0b0110000001100000
0b0100000001000000
0b0100000001000000
0b0100000001000000
0b0100000001000000
0b0110000001100000
0b0100000001000000
0b0100000001000000
0b0010000000100000
0b0010000000100000
0b0001000000010000
0b0001000000010000
0b0110000001100000
0b0010000000100000
0b0010000000100000
0b0010000000100000
0b0010000000100000
0b0110000001100000
0b0001000000010000
0b0010100000101000
0b0100010001000100
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0111111001111110
0b0100000001000000
0b0010000000100000
0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0000000000000000

0b0000000000000000
0b0000000000000000
0b0110011001100110
0b0001000100010001
0b0111011101110111
0b0111011101110111

0b0000000000000000
0b0100010001000100
0b0100010001000100
0b0110011001100110
0b0101010101010101
0b0111011101110111

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0011001100110011
0b0100010001000100
0b0011001100110011



0b0000000000000000
0b0001000100010001
0b0001000100010001
0b0011001100110011
0b0101010101010101
0b0111011101110111

0b0000000000000000
0b0000000000000000
0b0010001000100010
0b0111011101110111
0b0100010001000100
0b0011001100110011

0b0000000000000000
0b0001000100010001
0b0010001000100010
0b0111011101110111
0b0010001000100010
0b0010001000100010

0b0000000000000000
0b0011001100110011
0b0101010101010101
0b0111011101110111
0b0001000100010001
0b0110011001100110

0b0000000000000000
0b0100010001000100
0b0100010001000100
0b0110011001100110
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0010001000100010
0b0000000000000000
0b0010001000100010
0b0010001000100010
0b0010001000100010

0b0010001000100010
0b0000000000000000
0b0010001000100010
0b0010001000100010
0b0010001000100010
0b0100010001000100

0b0000000000000000
0b0100010001000100
0b0100010001000100
0b0101010101010101
0b0110011001100110
0b0101010101010101

0b0000000000000000
0b0100010001000100
0b0100010001000100
0b0100010001000100
0b0100010001000100
0b0010001000100010

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0110011001100110
0b0111011101110111
0b0101010101010101

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0110011001100110
0b0101010101010101
0b0101010101010101

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0010001000100010
0b0101010101010101
0b0010001000100010

0b0000000000000000
0b0000000000000000
0b0110011001100110
0b0101010101010101
0b0110011001100110
0b0100010001000100

0b0000000000000000
0b0000000000000000
0b0011001100110011
0b0101010101010101
0b0011001100110011
0b0001000100010001

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0110011001100110
0b0100010001000100
0b0100010001000100

0b0000000000000000
0b0000000000000000
0b0011001100110011
0b0100010001000100
0b0011001100110011
0b0110011001100110

0b0000000000000000
0b0100010001000100
0b0110011001100110
0b0100010001000100
0b0100010001000100
0b0010001000100010

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0011001100110011

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0101010101010101
0b0101010101010101
0b0010001000100010

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0101010101010101
0b0111011101110111
0b0010001000100010

0b0000000000000000
0b0000000000000000
0b0000000000000000
0b0101010101010101
0b0010001000100010
0b0101010101010101

0b0000000000000000
0b0000000000000000
0b0101010101010101
0b0011001100110011
0b0001000100010001
0b0110011001100110

0b0000000000000000
0b0000000000000000
0b0111011101110111
0b0001000100010001
0b0010001000100010
0b0111011101110111

0b0
0b0
0b0
0b0
0b0
0b0

0b0
0b0
0b0
0b0
0b0
0b0

0b0
0b0
0b0
0b0
0b0
0b0

0b0
0b0
0b0
0b0
0b0
0b0

0b0
0b0
0b0
0b0
0b0
0b0

0b0
0b0
0b0
0b0
0b0
0b0

0b0000000000000000
0b0111111001111110
0b0000001000000010
0b0000001000000010
0b0000000000000000
0b0000000000000000
0b0111011101110111
0b0100010101000101
0b0111011001110110
0b0100010101000101
0b0100010101000101
0b0111010101110101
0b0000000000000000
###
